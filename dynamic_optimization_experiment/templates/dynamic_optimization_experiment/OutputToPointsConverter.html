{% load otree %}

<div class="card bg-light m-3">
  <div class="card-body">
    <h3>
      Output To Points Converter
    </h3>
    <p>
      Enter the units of output you would like to convert into points and click OK.
    </p>
    <p>
      <input id="output_to_points_input" type="number"></input>
      <button style="background-color: red;"onClick=convertOutputToPoints(event)>OK</button>
      <br/>

      <h5>
        If you purchase <span id="output_units_container_span">XX.XX</span> units, 
        <br/>
        you will obtain <span id="points_container_span">YY.YY</span> Points
      </h5>
      <hr>

    </p>
    <table id="myTable" style="text-align: center;">
      <tbody>
          <!-- <tr style="background-color:chartreuse;"> -->
          <tr style="background-color: lightskyblue;">
              <td>Purchased Units</td>
              <td>Points</td>
          </tr>
          <tr>
            <td>1</td>
            <td>6.71</td>
          </tr>
          <tr>
            <td>2</td>
            <td>9.49</td>
          </tr>
          <tr>
            <td>3</td>
            <td>11.62</td>
          </tr>
          <tr>
            <td>11</td>
            <td>22.25</td>
          </tr>
      </tbody>
    </table>
    <div id="constants_k_payoff" style="display: none;">
      {{Constants.k_payoff}}
    </div>
    <script>
      //after user clicks OK button, calls convertOutputToPoints
      //which, in turn, calls 
      function updateUISpans(output,points){
        let unitsSpan = document.getElementById("output_units_container_span");
        let pointsSpan = document.getElementById("points_container_span");
        unitsSpan.innerHTML = output;
        pointsSpan.innerHTML = points;
        console.log('the UI is updated!');
      }

      //NOTE: 7 SEPT
      //The outputs from this function do not match up w/the table.
      //this function helps users convert output to points
      //maybe a weird bug here -- shouldn't inputDataFromOutputToPoints be of type number?
      function convertOutputToPoints(event){
        //stops the UI from thinking this is "submit" button event
        event.preventDefault();

        let inputDataFromOutputToPoints = Number(document.getElementById('output_to_points_input').value).toFixed(4);
        let constantKPayoff =  Number(document.getElementById("constants_k_payoff").innerHTML)
        let points = String( ((constantKPayoff * (inputDataFromOutputToPoints ^ 0.5)) +5) )

        return updateUISpans(inputDataFromOutputToPoints,points);
      }
    </script>
  </div>
</div>